

<!DOCTYPE html>

<html lang="el">
<head>
<script>
        // Έλεγχος αν ο χρήστης έχει ήδη δει το login
        if (!localStorage.getItem('visitedLogin')) {
        // Αν δεν έχει δει, αποθηκεύουμε ότι τώρα το βλέπει
            localStorage.setItem('visitedLogin', 'true');
        // Ανακατεύθυνση στο login.html
            window.location.href = "login.html";
        }
  // Αν έχει ήδη δει το login, δεν κάνουμε τίποτα (μπορεί να συνεχίσει στο index.html ή form.html)
</script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Αίτηση για Έγκριση Πρακτικής Άσκησης</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f8f9fb;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
}

.main-container {
    width: 90%;
    max-width: 1200px;
    margin: 30px auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.1);
}
.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    background-color: #fafafa;
    border-radius: 8px 8px 0 0;
}

h2 {
    text-align: center;
    color: #000000;
    font-size: 2em;
    margin-bottom: 30px;
}

.form-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 30px;
}

.logout-btn {
    background-color: #7f8c8d;
    color: white;
    padding: 8px 15px;
    border-radius: 4px;
    text-decoration: none;
}

.university-logo {
    height: auto;
}
.university-info {
    margin-left: 50px;
    text-align: right;
}
.university-info p {
    margin: 0;
    font-weight: bold;
}

fieldset {
    border: 2px solid #f4f4f9;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 10px;
    background-color: #fafafa;
    box-sizing: border-box;
    width: 100%;
}

legend {
    font-size: 1.4em;
    color: #ab0606;
    font-weight: bold;
}

label {
    display: block;
    margin: 10px 0 5px;
    color: #333;
    font-weight: 500;
}

input, textarea {
    width: 100%;
    padding: 10px;
    margin: 8px 0 20px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 1em;
    transition: all 0.3s ease;
}

input[type="text"], input[type="email"], input[type="number"] {
    font-size: 1.1em;
}

input:focus, textarea:focus {
    border-color: #000000;
    outline: none;
}

textarea {
    resize: vertical;
}

button {
    display: block;
    width: 100%;
    padding: 15px;
    margin-top: 40px;
    font-size: 1.2em;
    background-color: #2c3e50;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

button:hover {
    background-color: #1a252f;
}

.student-container, .employer-container {
    width: 48%;
    box-sizing: border-box;
    padding: 0 20px;
}

.file-input-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.file-input {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.approval-row {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    align-items: center;
}
.signature p{
    margin: 0;
}
.upload-status {
    font-weight: bold;
    color: green;
    margin-left: 10px;
}
.progress-container{
    width: 100%;
    background-color: #f3f3f3;
    border-radius: 5px;
    margin: 10px 0;
    height: 20px;
}
.progress-bar{
    width: 0;
    height: 100%;
    background-color: #4caf50;
    border-radius: 5px;
}
.modal{
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.4);
    padding-top: 60px;
}
.modal-content{
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}
.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
.attach-link {
    color: #0066cc;
    text-decoration: underline;
    cursor: pointer;
}
.attach-link:hover {
    color: #0044aa;
}
.options-container {
    margin-top: 10px;
    margin-bottom: 20px;
}
.option-title {
    font-weight: bold;
    margin-bottom: 5px;
}

/* Responsive για κινητά */
@media (max-width: 768px) {
    .form-container {
        flex-direction: column;
        gap: 10px;
    }

    .student-container, .employer-container {
        width: 100%;
        padding: 0;
    }

    .header {
        flex-direction: column;
        align-items: center;
        gap: 10px;
        text-align: center;
    }

    .university-info {
        margin-left: 0;
        text-align: center;
    }

    .logout-btn {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 1.1em;
    }

    h2 {
        font-size: 1.6em;
        margin-bottom: 20px;
    }

    fieldset {
        padding: 15px;
    }

    input, textarea, button {
        font-size: 1.1em;
    }

    button {
        padding: 18px;
    }

    .approval-row {
        flex-direction: column;
        gap: 10px;
    }

    .signature p {
        font-size: 1em;
    }
}

        </style>
</head>
<body>
<div class="main-container">
<div class="header">
<img class="university-logo" src="unofpel.png"/>
<div class="university-info">
<p><strong>ΣΧΟΛΗ ΟΙΚΟΝΟΜΙΑΣ ΚΑΙ ΤΕΧΝΟΛΟΓΙΑΣ</strong></p>
<p><strong>ΤΜΗΜΑ ΨΗΦΙΑΚΩΝ ΣΥΣΤΗΜΑΤΩΝ</strong></p>
</div>
<a class="logout-btn" href="login.html">Αποσύνδεση</a>
</div>
<h2>Αίτηση Έγκρισης Πρακτικής Άσκησης</h2>
<form action="/submit_form" enctype="multipart/form-data" id="application_id" method="POST">
<div class="form-container">
<!-- Στοιχεία Φοιτητή-->
<div class="student-container">
<h3>ΑΙΤΗΣΗ</h3>
<fieldset>
<legend>Στοιχεία Φοιτητή</legend>
<label for="stud_surname">Επώνυμο:</label>
<input id="stud_surname" name="stud_surname" required="" type="text"/>
<label for="stud_name">Όνομα:</label>
<input id="stud_name" name="stud_name" required="" type="text"/>
<label for="stud_fname">Όνομα Πατρός:</label>
<input id="stud_fname" name="stud_fname" required="" type="text"/>
<label for="stud_mname">Όνομα Μητρός:</label>
<input id="stud_mname" name="stud_mname" required="" type="text"/>
<label for="department">Τμήμα:</label>
<input id="department" name="department" readonly="" type="text" value="Ψηφιακών Συστημάτων"/>
<label for="sxolh">Σχολή:</label>
<input id="sxolh" name="sxolh" readonly="" type="text" value="Οικονομίας και Τεχνολογίας"/>
<label for="university">Πανεπιστήμιο:</label>
<input id="university" name="university" readonly="" type="text" value="Πανεπιστήμιο Πελοποννήσου"/>
<label for="stud_id">Αριθμός Μητρώου:</label>
<input id="stud_id" name="stud_id" required="" type="text"/>
<label for="stud_afm">ΑΦΜ:</label>
<input id="stud_afm" name="stud_afm" pattern="\d{9}" required="" title="Ο ΑΦΜ αποτελείται από 9 ψηφία" type="text"/>
<label for="stud_sem">Εξάμηνο Σπουδών:</label>
<input id="stud_sem" name="stud_sem" required="" type="text"/>
<label for="stud_address"><strong>Διεύθυνση:</strong></label>
<input id="stud_address" name="stud_address" required="" type="text"/>
<label for="stud_city">Πόλη:</label>
<input id="stud_city" name="stud_city" required="" type="text"/>
<label for="stud_zipcode">Ταχ. Κώδικας:</label>
<input id="stud_zipcode" name="stud_zipcode" required="" type="text"/>
<label for="stud_tel">Τηλ.:</label>
<input id="stud_tel" name="stud_tel" pattern="\d{10}" required="" title="Ο αριθμός τηλεφώνου αποτελείται από 10 ψηφία" type="text"/>
<label for="stud_email">Email:</label>
<input id="stud_email" name="stud_email" required="" type="email"/>
<div id="up_dilwsh_text_container" style="display: none;">
<label for="up_dilwsh_text">Υπεύθυνη Δήλωση:</label>
<textarea id="up_dilwsh_text" name="up_dilwsh_text"></textarea>
</div>
<div id="vevaiwsi_apodoxis_text_container" style="display: none;">
<label for="vevaiwsi_apodoxis_text">Βεβαίωση αποδοχής:</label>
<textarea id="vevaiwsi_apodoxis_text" name="vevaiwsi_apodoxis_text"></textarea>
</div>
<!-- Θέμα Έγκρισης -->
<h3>ΘΕΜΑ: Έγκριση Πρακτικής Άσκησης</h3>
<p>ΣΠΑΡΤΗ: <input id="current_date" readonly="" type="text"/></p>
<p><strong>ΕΠΙΤΡΟΠΗ ΠΡΑΚΤΙΚΗΣ ΑΣΚΗΣΗΣ:</strong></p>
<p>Εγκρίνεται η πραγματοποίηση της Π.Α. στη βάση των δεδομένων και των επισυναπτόμενων της αίτησης και ορίζονται:</p>
<p>α. Ημερομηνία έναρξης Π.Α.: <input id="start_date" readonly="" type="text"/></p>
<p>β. Επόπτης Καθηγητής: <input id="supervisor" required="" type="text"/></p>
<div class="approval-row">
<div class="signature">
<p>Ο Πρόεδρος</p>
<p>____________________</p>
</div>
<div class="signature">
<p>Τα μέλη</p>
<p>____________________</p>
</div>
</div>
</fieldset>
</div>
<!-- Στοιχεία Φορέα -->
<div class="employer-container">
<h3>Προς: Επιτροπή Πρακτικής Άσκησης</h3>
<p><strong>Παρακαλώ όπως εγκρίνετε την πραγματοποίηση της πρακτικής μου άσκησης στην υπηρεσία / επιχείρηση με τα παρακάτω στοιχεία:</strong></p>
<fieldset>
<legend>Στοιχεία Φορέα</legend>
<label for="emp_name">Όνομα Φορέα</label>
<input id="emp_name" name="emp_name" required="" type="text"/>
<label for="emp_addr">Διεύθυνση Φορέα</label>
<input id="emp_addr" name="emp_addr" required="" type="text"/>
<label for="emp_phone">Τηλέφωνο Φορέα</label>
<input id="emp_phone" name="emp_phone" required="" type="text"/>
<label for="emp_email">Ηλ. Διεύθυνση Φορέα</label>
<input id="emp_email" name="emp_email" required="" type="email"/>
<label for="emp_sup">Επόπτης Φορέα</label>
<input id="emp_sup" name="emp_sup" required="" type="text"/>
<!-- Δήλωση Φοιτητή -->
<label>Δηλώνω υπεύθυνα ότι:</label>
<p>α) δεν επιθυμώ να συμμετάσχω στο χρηματοδοτούμενο μέσω ΕΣΠΑ Πρόγραμμα Π.Α. και</p>
<p>β) εντός ενός μηνός από την λήξη της πρακτικής μου άσκησης, οφείλω να καταθέσω στη Γραμματεία του Τμήματος με δική μου ευθύνη Έκθεση Πεπραγμένων, αντίγραφο κατάστασης απόδοσης ενσήμων (από τον Ε.Φ.Κ.Α. πρώην Ι.Κ.Α.) για την πιστοποίηση της ασφάλισης του/της φοιτητή/τριας κατά το διάστημα της πρακτικής άσκησης, καθώς και βεβαίωση περάτωσης της πρακτικής άσκησης από τον Φορέα.</p>
<div class="approval-row">
<div class="signature">
<p><strong>Ο/Η Αιτών/ούσα</strong></p>
<p>____________________</p>
<p>Υπογραφή</p>
</div>
</div>
<div class="attachments">
<p><strong>Συνημμένα:</strong></p>
<p>1. Βεβαίωση ότι πληρώ τις προϋποθέσεις έναρξης Πρακτικής Άσκησης ή Αναλυτική Βαθμολογία από τη Γραμματεία του Τμήματος.</p>
<label class="upload-file" for="anal_vathm">Ανεβάστε αρχείο PDF:</label>
<input accept=".pdf" id="anal_vathm" name="anal_vathm" onchange="updateFileStatus('anal_vathm')" type="file"/>
<span id="status_anal_vathm" style="margin-left: 10px; font-weight: bold; color: red;">❌ Δεν έχει υποβληθεί</span>
<p><a class="attach-link" href="vevaiwsi_apodoxis.html" onclick="saveFormData()">2. Βεβαίωση αποδοχής απασχόλησης από το φορέα:</a></p>
<label class="upload-file" for="vevaiwsi_apodoxis_file">Ανεβάστε αρχείο PDF:</label>
<input accept=".pdf" id="vevaiwsi_apodoxis_file" name="vevaiwsi_apodoxis_file" onchange="updateFileStatus('vevaiwsi_apodoxis_file')" type="file"/>
<span id="status_vevaiwsi_apodoxis_file" style="margin-left: 10px; font-weight: bold; color: red;">❌ Δεν έχει υποβληθεί</span>
<p><a class="attach-link" href="up_dilwsh.html" onclick="saveFormData()">3. Υπεύθυνη Δήλωση:</a></p>
<label class="upload-file" for="up_dilwsh_file">Ανεβάστε αρχείο PDF:</label>
<input accept=".pdf" id="up_dilwsh_file" name="up_dilwsh_file" onchange="updateFileStatus('up_dilwsh_file')" type="file"/>
<span id="status_up_dilwsh_file" style="margin-left: 10px; font-weight: bold; color: red;">❌ Δεν έχει υποβληθεί</span>
</div>
</fieldset>
</div>
</div>
<button id="submit_button" type="button">Υποβολή Δήλωσης</button>
</form>
</div>
<script>
// Αποθήκευση προσωρινών δεδομένων όταν αλλάζει κάτι στη φόρμα
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("application_id");
  const studentId = localStorage.getItem("active_student_id");
  const idInput = document.getElementById("stud_id");
  const submitted = localStorage.getItem(`student_${studentId}_data`);


  // Αν υπάρχει ενεργός φοιτητής, κλειδώνει το πεδίο ΑΜ
  if (studentId && idInput) {
    idInput.value = studentId;
    idInput.readOnly = true;
  }

  
// Επιτρέπουμε επεξεργασία μόνο αν ΔΕΝ έρχεται από edit
const urlParams = new URLSearchParams(window.location.search);
const isEdit = urlParams.get("edit");

if (studentId && submitted && !isEdit) {
  window.location.href = "student.html";
}


  // Προσυμπλήρωση ημερομηνιών
  const today = new Date();
  const todayFormatted = today.toLocaleDateString("el-GR");
  const currentDateInput = document.getElementById("current_date");
  if (currentDateInput && !currentDateInput.value) {
    currentDateInput.value = todayFormatted;
  }

  const startDate = new Date(today);
  startDate.setDate(today.getDate() + 7);
  const startFormatted = startDate.toLocaleDateString("el-GR");
  const startDateInput = document.getElementById("start_date");
  if (startDateInput && !startDateInput.value) {
    startDateInput.value = startFormatted;
  }

  const inputs = ["anal_vathm", "vevaiwsi_apodoxis_file", "up_dilwsh_file"];
  inputs.forEach(id => {
    const htmlKey = id.includes("anal") ? "analytiki_vathmologia_html" : id.includes("vevaiwsi") ? "vevaiwsi_apodoxis_html" : "up_dilwsh_html";
    const htmlExists = localStorage.getItem(`${htmlKey}_${studentId}`);
    const fileUploaded = localStorage.getItem(`${id}_submitted_${studentId}`);
    const statusSpan = document.getElementById(`status_${id}`);
    if (statusSpan) {
      if (htmlExists || fileUploaded === "true") {
        statusSpan.textContent = "✔️ Έχει υποβληθεί";
        statusSpan.style.color = "green";
      } else {
        statusSpan.textContent = "❌ Δεν έχει υποβληθεί";
        statusSpan.style.color = "red";
      }
    }
  });

  // Αποθήκευση αλλαγών σε πεδία
  form.addEventListener("input", () => {
    const formData = new FormData(form);
    const tempData = {};
    for (const [key, value] of formData.entries()) {
      tempData[key] = value;
    }
    if (studentId) {
localStorage.setItem(`temp_form_data_${studentId}`, JSON.stringify(tempData));
localStorage.setItem(`aitisi_form_data_${studentId}`, JSON.stringify(tempData));
    }
  });

  // Ανάκτηση προσωρινών δεδομένων αν υπάρχουν
  if (studentId) {
    const saved = localStorage.getItem(`temp_form_data_${studentId}`);
    if (saved) {
      const data = JSON.parse(saved);
      for (const key in data) {
        const input = document.getElementById(key);
        if (input && input.type !== "file") {
          input.value = data[key];
        }
      }
    }

        // Προσυμπλήρωση στοιχείων φοιτητή από localStorage
const storedName = localStorage.getItem("stud_name");
const storedSurname = localStorage.getItem("stud_surname");
const storedFname = localStorage.getItem("stud_fname");

if (storedName) {
  const nameInput = document.getElementById("stud_name");
  if (nameInput) nameInput.value = storedName;
}
if (storedSurname) {
  const surnameInput = document.getElementById("stud_surname");
  if (surnameInput) surnameInput.value = storedSurname;
}
if (storedFname) {
  const fnameInput = document.getElementById("stud_fname");
  if (fnameInput) fnameInput.value = storedFname;
}
  }
});
</script>

<script>
// Συνάρτηση για αποθήκευση προσωρινών δεδομένων πριν τη μετάβαση σε άλλη φόρμα
function saveFormData() {
  const form = document.getElementById("application_id");
  const studentId = localStorage.getItem("active_student_id");
  if (!form || !studentId) return;

  const formData = new FormData(form);
  const data = {};
  for (const [key, value] of formData.entries()) {
    data[key] = value;
  }

  localStorage.setItem(`temp_form_data_${studentId}`, JSON.stringify(data));
}
</script>

<script>
// Υποβολή και αποθήκευση των τελικών δεδομένων
document.getElementById("submit_button").addEventListener("click", function (event) {

      const requiredFields = [
    "stud_surname", "stud_name", "stud_fname", "stud_mname",
    "stud_afm", "stud_sem", "stud_address", "stud_city", 
    "stud_zipcode", "stud_tel", "stud_email", "supervisor",
    "emp_name", "emp_addr", "emp_phone", "emp_email", "emp_sup"
  ];

  let valid = true;
  for (const id of requiredFields) {
    const input = document.getElementById(id);
    if (!input || input.value.trim() === "") {
      alert(`Το πεδίο "${input?.previousElementSibling?.textContent || id}" είναι υποχρεωτικό.`);
      input?.focus();
      valid = false;
      break;
    }
  }

  // Έλεγχος Εξαμήνου
  const semester = parseInt(document.getElementById("stud_sem").value.trim());
  if (isNaN(semester) || semester < 6) {
    alert("Το εξάμηνο πρέπει να είναι τουλάχιστον 6ο.");
    document.getElementById("stud_sem").focus();
    return;
  }

  // Έλεγχος εγγράφων
  const fileChecks = [
    { id: "anal_vathm", name: "Αναλυτική Βαθμολογία" },
    { id: "vevaiwsi_apodoxis_file", name: "Βεβαίωση Αποδοχής" },
    { id: "up_dilwsh_file", name: "Υπεύθυνη Δήλωση" }
  ];

  for (const file of fileChecks) {
    const input = document.getElementById(file.id);
    const uploaded = localStorage.getItem(`${file.id}_submitted_${studentId}`) === "true";
    const htmlStored = localStorage.getItem(`${file.id.includes("anal") ? "analytiki_vathmologia_html" : file.id.includes("vevaiwsi") ? "vevaiwsi_apodoxis_html" : "up_dilwsh_html"}_${studentId}`);
    
    if (!input.files.length && !uploaded && !htmlStored) {
      alert(`Δεν έχετε ανεβάσει το αρχείο: ${file.name}`);
      input.scrollIntoView({ behavior: "smooth" });
      return;
    }
  }



  event.preventDefault();
  const data = {};
  const studentId = localStorage.getItem("active_student_id");

  // Συλλογή ΟΛΩΝ των input/textarea πεδίων, όχι μόνο αυτών με name
  document.querySelectorAll("input, textarea").forEach(el => {
    if (el.type !== "file") {
      const key = el.name || el.id;
      if (key) data[key] = el.value;
    }
  });

  if (!studentId && !data["stud_id"]) {
    alert("Δεν βρέθηκε Αριθμός Μητρώου.");
    return;
  }

  const finalId = studentId || data["stud_id"];
  data["current_date"] = new Date().toISOString();

  // Αποθήκευση των πλήρων δεδομένων
  localStorage.setItem(`student_${finalId}_data`, JSON.stringify(data));
  localStorage.setItem(`student_${finalId}_status`, "Pending");
  localStorage.setItem(`student_${finalId}_comments`, "");

  // Καθαρισμός προσωρινών
localStorage.removeItem(`temp_form_data_${finalId}`);
localStorage.removeItem(`aitisi_form_data_${finalId}`);

  alert("✅ Η αίτηση υποβλήθηκε με επιτυχία!");
  window.location.href = "student.html";



  const logs = JSON.parse(localStorage.getItem(`student_${studentId}_log`) || "[]");
logs.push({
    action: "Υποβλήθηκε",
    by: "Φοιτητής",
    date: new Date().toLocaleString("el-GR")
});
localStorage.setItem(`student_${studentId}_log`, JSON.stringify(logs)); 
});



</script>

</body>
</html>